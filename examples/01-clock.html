<p class="description">
  This example shows a simple clock that uses the SSE stream to show the current
  server time every second.
</p>
<button
  id="start-clock"
  class="ui-button"
  type="button"
>
  <i class="fa fa-play uk-margin-small-right"></i>
  Start
</button>
<button
  id="stop-clock"
  class="ui-button ui-priority-secondary uk-margin-right"
  type="button"
>
  <i class="fa fa-stop uk-margin-small-right"></i>
  Stop
</button>
<span class="uk-text-nowrap">
  Clock:
  <span
    id="clock"
    class="uk-margin-small-left"
    >--- not yet started ---</span
  >
</span>
<script>
  (() => {
    let isRunning = false;
    let start = document.querySelector("#start-clock");
    let stop = document.querySelector("#stop-clock");
    let clock = document.querySelector("#clock");
    let conn = false;

    // handle clicks on start button
    start.addEventListener("click", (e) => {
      // prevent starting stream more than once
      if (isRunning) return;
      isRunning = true;

      // start stream and update the conn variable
      conn = RockSSE.start({
        url: "/examples/clock",
        onmessage: (msg) => {
          clock.innerText = msg;
        },
        onerror: (event) => {
          isRunning = false;
        },
      });
    });

    // handle clicks on stop button
    stop.addEventListener("click", (e) => {
      // prevent stopping stream more than once
      if (!isRunning) return;
      isRunning = false;

      // close connection
      conn.close();

      // update text
      clock.innerText = "--- stopped ---";
    });
  })();
</script>
