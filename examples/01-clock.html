<p class="description">
  This example shows a simple clock that uses the SSE stream to show the current
  server time every second.
</p>
{buttons}
<span class="uk-text-nowrap">
  Server Time:
  <span class="uk-margin-small-left clock">--- not yet started ---</span>
</span>
<script>
  (() => {
    const stream = RockSSE.addStream("/examples/clock");

    // dom elements
    const li = document.currentScript.closest("li.Inputfield");
    const start = li.querySelector(".start");
    const stop = li.querySelector(".stop");
    const clock = li.querySelector(".clock");

    // handle clicks on start button
    start.addEventListener("click", () => {
      stream.start();
    });

    // handle clicks on stop button
    stop.addEventListener("click", () => {
      stream.stop();
    });

    // setup stream
    stream.debug = true;
    stream.onmessage = (event) => {
      clock.innerText = event.data;
    };
    stream.stopped = () => {
      clock.innerText = "--- stopped ---";
    };
  })();

  (() => {
    return;
    let isRunning = false;
    const li = document.currentScript.closest("li.Inputfield");
    const start = li.querySelector(".start");
    const stop = li.querySelector(".stop");
    const clock = li.querySelector(".clock");
    let conn = false;

    // handle clicks on start button
    start.addEventListener("click", (e) => {
      // prevent starting stream more than once
      if (isRunning) return;
      isRunning = true;

      // start stream and update the conn variable
      conn = RockSSE.start({
        url: "/examples/clock",
        onmessage: (msg) => {
          clock.innerText = msg;
        },
        onerror: (event) => {
          isRunning = false;
        },
      });
    });

    // handle clicks on stop button
    stop.addEventListener("click", (e) => {
      // prevent stopping stream more than once
      if (!isRunning) return;
      isRunning = false;

      // close connection
      conn.close();

      // update text
      clock.innerText = "--- stopped ---";
    });
  })();
</script>
