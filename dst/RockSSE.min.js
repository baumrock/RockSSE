var RockSSE;(()=>{class _RockSSE{streams={};addStream(url){const stream=new Stream(url);this.streams[url]=stream;console.log("added stream",stream);return stream}}
class Stream{conn=!1;debug=!1;isRunning=!1;url=!1;errorAlert=!1;onmessage=!1;onerror=!1;ondone=!1;onstart=!1;onstop=!1;onstarted=!1;onstopped=!1;constructor(url){this.url=url}
addCallbacks(){const conn=this.conn;conn.onmessage=(event)=>{if(event.data===ProcessWire.config["rocksse-done"]){this.stop();if(this.ondone)this.ondone();return}
if(this.onmessage)this.onmessage(event);};conn.onerror=(event)=>{if(this.onerror)this.onerror(event);if(this.errorAlert){this.errorAlert(event)}else{console.error(event);alert("Error - check console")}}}
log(data){if(!this.debug)return;console.log(data)}
message(msg){if(!this.onmessage)return;this.onmessage({data:msg})}
getJSON(msg){try{return JSON.parse(msg)}catch(error){return!1}}
start(){if(this.onstart)this.onstart();if(this.isRunning)return;this.log("starting stream ...",this.url);this.isRunning=!0;this.conn=new EventSource("/rocksse"+this.url);this.addCallbacks();if(this.onstarted)this.onstarted();}
stop(){if(this.onstop)this.onstop();if(!this.isRunning)return;this.log("stopping stream ...");this.isRunning=!1;if(this.conn){this.conn.close();this.conn=null}
if(this.onstopped)this.onstopped();}}
RockSSE=new _RockSSE()})()